<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interior Door Configurator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>

    <div class="container">
        <div class="logo-container">
            <img src="your-logo.png" alt="Your Company Logo">
        </div>
        
        <h1>Interior Door Configurator</h1>

        <div class="configurator-wrapper">
            <div id="options-container"></div>
            <button id="reset-button">Reset</button>
        </div>
        <div class="preview-wrapper">
            <h3>Preview</h3>
            <img id="door-image" src="https://via.placeholder.com/300x400.png?text=Select+Door" alt="Door preview">
            <div id="result" class="result-box">
                <h3>Your Configuration:</h3>
                <p id="item-desc-result"></p>
                <p class="item-number">Pro Stock #: <span id="pro-stock-result"></span></p>
                <p class="item-number">Current Stock #: <span id="current-stock-result"></span></p>
                <p>Full Desc: <span id="full-desc-result"></span></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const optionsContainer = document.getElementById('options-container');
            const resultBox = document.getElementById('result');
            const proStockResult = document.getElementById('pro-stock-result');
            const currentStockResult = document.getElementById('current-stock-result');
            const itemDescResult = document.getElementById('item-desc-result');
            const fullDescResult = document.getElementById('full-desc-result');
            const doorImage = document.getElementById('door-image');
            const resetButton = document.getElementById('reset-button');

            let csvData = [];
            const filterColumns = ['Door Style', 'Product Category', 'Size', 'Handing', 'Jamb', 'Casing', 'Hinges'];

            // --- 1. Load CSV Data ---
            Papa.parse('doors.csv', {
                download: true,
                header: true,
                skipEmptyLines: true,
                transformHeader: header => header.trim(),
                complete: function(results) {
                    csvData = results.data;
                    initialize();
                }
            });
            
            // --- 2. Initial Setup ---
            function initialize() {
                // Create dropdowns
                optionsContainer.innerHTML = '';
                filterColumns.forEach((header, index) => {
                    const group = document.createElement('div');
                    group.className = 'option-group';
                    const label = document.createElement('label');
                    label.textContent = header;
                    const select = document.createElement('select');
                    select.id = `select-${index}`;
                    select.dataset.level = index;
                    select.dataset.header = header;
                    group.appendChild(label);
                    group.appendChild(select);
                    optionsContainer.appendChild(group);
                });
                
                // Add event listeners
                optionsContainer.addEventListener('change', handleOptionChange);
                resetButton.addEventListener('click', resetAll);
                
                // Start the process
                resetAll();
            }

            // --- 3. Full Reset Logic ---
            function resetAll() {
                resultBox.style.display = 'none';
                doorImage.src = 'https://via.placeholder.com/300x400.png?text=Select+Door';
                // Populate the first dropdown and disable the rest
                updateDropdown(0, csvData);
                for (let i = 1; i < filterColumns.length; i++) {
                    const select = document.getElementById(`select-${i}`);
                    select.innerHTML = '';
                    const defaultOption = document.createElement('option');
                    defaultOption.textContent = `Select a ${filterColumns[i-1]} first`;
                    select.appendChild(defaultOption);
                    select.disabled = true;
                }
            }

            // --- 4. Core Change Handler (NEW LOGIC) ---
            function handleOptionChange(event) {
                const changedLevel = parseInt(event.target.dataset.level);
                resultBox.style.display = 'none'; // Always hide result on change

                // Loop from the *next* level downwards
                for (let i = changedLevel + 1; i < filterColumns.length; i++) {
                    const selectionsSoFar = getSelections(i - 1);
                    
                    // If a preceding selection is missing, we can't populate this dropdown.
                    if (Object.keys(selectionsSoFar).length !== i) {
                        const select = document.getElementById(`select-${i}`);
                        select.innerHTML = '';
                        select.disabled = true;
                        continue;
                    }
                    
                    const filteredData = csvData.filter(row => {
                        return Object.keys(selectionsSoFar).every(key => row[key] === selectionsSoFar[key]);
                    });
                    
                    updateDropdown(i, filteredData);
                }
                
                // After updates, check if a full configuration is present
                const finalSelections = getSelections();
                if (Object.keys(finalSelections).length === filterColumns.length) {
                    displayResult(finalSelections);
                }
            }

            // --- 5. Dropdown Population Utility (NEW LOGIC) ---
            function updateDropdown(level, data) {
                const select = document.getElementById(`select-${level}`);
                const header = select.dataset.header;
                const oldValue = select.value;

                const uniqueOptions = [...new Set(data.map(row => row[header]))].sort((a,b) => isNaN(a) || isNaN(b) ? a.localeCompare(b) : a - b);
                
                select.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.textContent = `Select a ${header}`;
                defaultOption.disabled = true;
                select.appendChild(defaultOption);
                
                uniqueOptions.forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val;
                    select.appendChild(option);
                });
                
                // If the old value is still a valid option, re-select it
                if (uniqueOptions.includes(oldValue)) {
                    select.value = oldValue;
                } else {
                    select.selectedIndex = 0; // Otherwise, reset to the default prompt
                }

                select.disabled = false;
            }

            // --- 6. Helper to get current selections ---
            function getSelections(maxLevel = filterColumns.length - 1) {
                const selections = {};
                for (let i = 0; i <= maxLevel; i++) {
                    const select = document.getElementById(`select-${i}`);
                    if (select.value && !select.options[select.selectedIndex].disabled) {
                        selections[select.dataset.header] = select.value;
                    } else {
                        return {}; // Return empty if any selection is not valid
                    }
                }
                return selections;
            }

            // --- 7. Display Final Result ---
            function displayResult(selections) {
                const foundRow = csvData.find(row => {
                    return Object.keys(selections).every(key => row[key] === selections[key]);
                });

                if (foundRow) {
                    const proStockNum = parseFloat(foundRow['Lowe\'s Pro Stock Item Number']);
                    const currentStockNum = parseFloat(foundRow['Current Lowe\'s Stock Item Number']);
                    proStockResult.textContent = !isNaN(proStockNum) ? proStockNum : 'N/A';
                    currentStockResult.textContent = !isNaN(currentStockNum) ? currentStockNum : 'N/A';
                    itemDescResult.textContent = foundRow['Item Description'] || 'N/A';
                    fullDescResult.textContent = foundRow['Full Description'] || 'N/A';
                    if (foundRow.Image && foundRow.Image.trim() !== '') {
                        doorImage.src = foundRow.Image;
                    } else {
                        doorImage.src = 'https://via.placeholder.com/300x400.png?text=No+Image';
                    }
                    resultBox.style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>