<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Door Configurator</title>
    
    <!-- The <style> block has been replaced with this link to your new CSS file -->
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>

    <div class="container">
        <div class="logo-container">
            <img src="your-logo.png" alt="Your Company Logo">
        </div>
        
        <h1>Door Configurator</h1>

        <div class="configurator-wrapper">
            <div id="options-container"></div>
            <button id="reset-button">Reset</button>
        </div>
        <div class="preview-wrapper">
            <h3>Preview</h3>
            <img id="door-image" src="https://via.placeholder.com/300x400.png?text=Select+Door" alt="Door preview">
            <div id="result" class="result-box">
                <h3>Your Configuration:</h3>
                <p id="item-desc-result"></p>
                <p class="item-number">Pro Stock #: <span id="pro-stock-result"></span></p>
                <p class="item-number">Current Stock #: <span id="current-stock-result"></span></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const optionsContainer = document.getElementById('options-container');
            const resultBox = document.getElementById('result');
            const proStockResult = document.getElementById('pro-stock-result');
            const currentStockResult = document.getElementById('current-stock-result');
            const itemDescResult = document.getElementById('item-desc-result');
            const doorImage = document.getElementById('door-image');
            const resetButton = document.getElementById('reset-button');

            let csvData = [];
            
            const filterColumns = [
                'Program', 'Material', 'Core_Type', 'Style', 'Configuration', 'Finish_Texture',
                'Glass_Info', 'Size_Width_in', 'Size_Height_in', 'Bore_Status', 'Handing', 'Jamb_Type',
                'Jamb_Casing', 'Hinge_Finish', 'Special_Features'
            ];

            Papa.parse('doors_final_updated.csv', {
                download: true,
                header: true,
                skipEmptyLines: true,
                transformHeader: header => header.trim(),
                complete: function(results) {
                    csvData = results.data;
                    initialize();
                }
            });
            
            function initialize() {
                optionsContainer.innerHTML = '';
                filterColumns.forEach((header, index) => {
                    const group = document.createElement('div');
                    group.className = 'option-group';
                    const label = document.createElement('label');
                    label.textContent = header.replace(/_/g, ' '); 
                    const select = document.createElement('select');
                    select.id = `select-${index}`;
                    select.dataset.level = index;
                    select.dataset.header = header;
                    group.appendChild(label);
                    group.appendChild(select);
                    optionsContainer.appendChild(group);
                });
                
                optionsContainer.addEventListener('change', handleOptionChange);
                resetButton.addEventListener('click', resetAll);
                
                resetAll();
            }

            function resetAll() {
                resultBox.style.display = 'none';
                doorImage.src = 'https://via.placeholder.com/300x400.png?text=Select+Door';
                updateDropdown(0, csvData, true);
                for (let i = 1; i < filterColumns.length; i++) {
                    const select = document.getElementById(`select-${i}`);
                    select.innerHTML = '';
                    const defaultOption = document.createElement('option');
                    defaultOption.textContent = `Select a ${filterColumns[i-1].replace(/_/g, ' ')} first`;
                    select.appendChild(defaultOption);
                    select.disabled = true;
                }
                updateValidationStyles();
            }
            
            function handleOptionChange(event) {
                const changedLevel = parseInt(event.target.dataset.level);
                resultBox.style.display = 'none';

                let selections = getSelections(changedLevel);
                
                for (let i = changedLevel + 1; i < filterColumns.length; i++) {
                    const filteredData = csvData.filter(row => {
                        return Object.keys(selections).every(key => row[key] === selections[key]);
                    });
                    
                    updateDropdown(i, filteredData, false);
                    
                    selections = getSelections(i);
                }
                
                updateValidationStyles();
                checkAndDisplayResult();
            }
            
            function updateDropdown(level, data, forceReset) {
                const select = document.getElementById(`select-${level}`);
                const header = select.dataset.header;
                const oldValue = select.value;

                const uniqueOptions = [...new Set(data.map(row => row[header]).filter(val => val && val.trim() !== ''))].sort((a,b) => {
                    return isNaN(a) || isNaN(b) ? a.localeCompare(b, undefined, {numeric: true}) : a - b;
                });
                
                select.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.textContent = `Select a ${header.replace(/_/g, ' ')}`;
                defaultOption.disabled = true;
                select.appendChild(defaultOption);
                
                uniqueOptions.forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val;
                    select.appendChild(option);
                });
                
                if (uniqueOptions.length === 0) {
                    select.selectedIndex = 0;
                    defaultOption.textContent = "Not Applicable";
                    select.disabled = true;
                } else {
                    select.disabled = false;
                    if (uniqueOptions.includes(oldValue) && !forceReset) {
                        select.value = oldValue;
                    } else {
                        select.selectedIndex = 0;
                    }
                }
            }

            function getSelections(maxLevel = filterColumns.length - 1) {
                const selections = {};
                for (let i = 0; i <= maxLevel; i++) {
                    const select = document.getElementById(`select-${i}`);
                    if (!select.disabled && select.value && !select.options[select.selectedIndex].disabled) {
                        selections[select.dataset.header] = select.value;
                    }
                }
                return selections;
            }

            function updateValidationStyles() {
                for (let i = 0; i < filterColumns.length; i++) {
                    const select = document.getElementById(`select-${i}`);
                    const isValid = select.disabled || (select.value && !select.options[select.selectedIndex].disabled);
                    
                    if (isValid) {
                        select.classList.remove('needs-attention');
                    } else {
                        select.classList.add('needs-attention');
                    }
                }
            }

            function checkAndDisplayResult() {
                const selections = getSelections();
                const activeDropdowns = document.querySelectorAll('#options-container select:not(:disabled)');
                
                if (Object.keys(selections).length > 0 && Object.keys(selections).length === activeDropdowns.length) {
                    const foundRow = csvData.find(row => {
                        return Object.keys(selections).every(key => row[key] === selections[key]);
                    });

                    if (foundRow) {
                        proStockResult.textContent = foundRow["Lowe's_Pro_Stock_Item_Number"] || 'N/A';
                        currentStockResult.textContent = foundRow["Current_Stock_Item_Number"] || 'N/A';
                        itemDescResult.textContent = foundRow["Original_Description"] || 'N/A';
                        resultBox.style.display = 'block';
                    }
                }
            }
        });
    </script>
</body>
</html>
